
# HG changeset patch
# User Zibi Braniecki <zbraniecki@mozilla.com>
# Date 1536964645 0
# Node ID afe1daa73e5650119cbfd0daf638bc2f5ce8a26f
# Parent  f703642afd0bbbba0110d0fab6a6018c2dcaf98c
Bug 1305705 - Don`t unregister langpacks on shutdown. r=aswan

Differential Revision: https://phabricator.services.mozilla.com/D5909

diff --git a/toolkit/components/extensions/Extension.jsm b/toolkit/components/extensions/Extension.jsm
--- a/toolkit/components/extensions/Extension.jsm
+++ b/toolkit/components/extensions/Extension.jsm
@@ -2027,16 +2027,21 @@ class Langpack extends ExtensionData {
       ));
     }
 
     Services.obs.notifyObservers({wrappedJSObject: {langpack: this}},
                                  "webextension-langpack-startup");
   }
 
   async shutdown(reason) {
+    if (reason === "APP_SHUTDOWN") {
+      // If we're shutting down, let's not bother updating the state of each
+      // system.
+      return;
+    }
     for (const sourceName of Object.keys(this.startupData.l10nRegistrySources)) {
       L10nRegistry.removeSource(`${sourceName}-${this.startupData.langpackId}`);
     }
     if (this.chromeRegistryHandle) {
       this.chromeRegistryHandle.destruct();
       this.chromeRegistryHandle = null;
     }
 

